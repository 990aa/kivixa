name: Performance Tests

on:
  push:
    branches: [main, performance/*]
  pull_request:
    branches: [main]

jobs:
  analyze-and-test:
    runs-on: windows-latest
    
    steps:
    - uses: actions/checkout@v4
    
    - name: Setup Flutter
      uses: subosito/flutter-action@v2
      with:
        flutter-version: '3.35.0'
        channel: 'stable'
        
    - name: Get dependencies
      run: flutter pub get
      
    - name: Run Unit Tests
      run: flutter test
      
    - name: Analyze Code
      run: flutter analyze
      
    - name: Check Benchmark Utils
      run: dart analyze performance_benchmarks/benchmark_utils.dart

    # Performance thresholds (see performance_benchmarks/benchmark_utils.dart):
    # - Startup: < 3000ms
    # - Frame build p95: < 12ms  
    # - Frame raster p95: < 8ms
    #
    # Manual performance testing in profile mode required for actual measurements.
    # See performance_benchmarks/README.md for instructions.
